# 信捷PLC 64位浮点数寄存器读写说明

## 概述

本系统已实现与信捷PLC兼容的64位浮点数(双精度浮点数)寄存器读写功能，遵循IEEE 754双精度浮点数标准和信捷PLC的Modbus寄存器存储格式。

## 技术规格

### 数据格式
- **类型**: IEEE 754双精度浮点数 (64位)
- **精度**: 15-17位有效数字
- **指数范围**: -1022 到 +1023
- **存储空间**: 4个连续的16位Modbus寄存器

### 字节序规范(信捷PLC)
信捷PLC使用标准Modbus大端序存储格式：

```
64位浮点数: [MSB -------- 中间字节 -------- LSB]
寄存器分布:  Reg[0]  Reg[1]  Reg[2]  Reg[3]
字节序:      高位字  次高位  次低位  低位字
```

#### 示例
以π (3.141592653589793)为例：
- **IEEE 754表示**: `400921FB54442D18`
- **寄存器分布**:
  - 寄存器[0] = `0x4009` (16393)
  - 寄存器[1] = `0x21FB` (8699)  
  - 寄存器[2] = `0x5444` (21572)
  - 寄存器[3] = `0x2D18` (11544)

## API接口

### 读取64位浮点数
```http
GET /api/plc/float64?address=200
```

**参数**:
- `address`: 起始寄存器地址 (默认200)

**响应**:
```json
{
  "success": true,
  "data": 3.141592653589793
}
```

### 写入64位浮点数
```http
POST /api/plc/float64
Content-Type: application/json

{
  "address": 200,
  "value": 3.141592653589793
}
```

**响应**:
```json
{
  "success": true,
  "message": "写入成功"
}
```

## 前端界面

在设备管理页面的"PLC测试"区域中新增了"64位浮点寄存器读写"功能模块，包含：

1. **寄存器地址设置**: 可配置起始地址(默认200)
2. **读取功能**: 实时读取并显示当前值(精度8位小数)
3. **写入功能**: 支持输入高精度浮点数值
4. **状态指示**: 实时显示读写操作状态

## 地址范围

- **默认地址**: 200 (占用地址200-203)
- **地址范围**: 支持PLC的完整寄存器地址空间
- **连续性要求**: 确保目标地址+3在有效范围内

## 精度说明

- **输入精度**: 支持JavaScript Number的完整精度
- **存储精度**: IEEE 754双精度标准
- **显示精度**: 前端显示8位小数
- **传输精度**: Modbus传输保持完整精度

## 错误处理

系统包含完整的错误处理机制：

1. **连接检查**: 确保PLC连接正常
2. **地址验证**: 验证寄存器地址有效性
3. **数值验证**: 确保输入为有效浮点数
4. **传输错误**: 处理Modbus通信异常
5. **实时反馈**: 操作状态和错误信息实时显示

## 与32位浮点数的区别

| 特性 | 32位浮点数 | 64位浮点数 |
|------|------------|------------|
| 精度 | 6-7位有效数字 | 15-17位有效数字 |
| 存储空间 | 2个寄存器 | 4个寄存器 |
| 数值范围 | ±3.4×10³⁸ | ±1.8×10³⁰⁸ |
| 适用场景 | 一般测量 | 高精度计算 |

## 兼容性

- ✅ 信捷PLC XC系列
- ✅ 支持Modbus TCP/RTU协议
- ✅ 标准IEEE 754格式
- ✅ 大端序字节组织
- ✅ 高位字在前存储

## 注意事项

1. **地址对齐**: 建议使用4的倍数作为起始地址
2. **数据同步**: 读写操作会占用4个连续寄存器
3. **精度保持**: 确保PLC侧也配置为64位浮点数类型
4. **字节序**: 严格按照信捷PLC的大端序格式处理

---

*最后更新: 2024年1月* 